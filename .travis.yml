sudo: false
language: python
python:
  - "3.6"
cache:
  directories:
    - $HOME/.pip-cache/
install:
  - pip install --upgrade pip --cache-dir $HOME/.pip-cache/
  - pip install coveralls coverage --cache-dir $HOME/.pip-cache/
  - pip install -r requirements-dev.txt --cache-dir $HOME/.pip-cache/
  - pip install -e . --cache-dir $HOME/.pip-cache/
script:
  - flake8 molo
  - molo scaffold testapp --include molo.commenting ^commenting/
  - mkdir -p testapp/testapp/templates/core
  - cp molo/commenting/test_templates/article_page.html testapp/testapp/templates/core/article_page.html
  - cp molo/commenting/test_templates/main.html testapp/testapp/templates/core/main.html
  - flake8 testapp
  - cp test_settings.py testapp/testapp/settings/local.py
  - pip install -e testapp
  - py.test --cov=molo
after_success:
  - coveralls
before_deploy:
  - pip install twine
deploy:
  provider: pypi
  user: Praekelt
  password:
    secure: "54fJjn3MQ0nnKqaQ/6ZbJ4d3vG1HuyQg9thbfit609BqUnzLiK0hyj49w/NM7nonraDvW3LPhrLfrvfFX9pvGMav3bjlIBrTT6JjiSB16sTxgEMy6if+AKMRap4zWTt/9PUxOYqfZiuHJVMnorOPVsba4Q0fonzMoykJdcEpylXLaTaXNYKLa6Vp8+m3/3QJuDioYJ8TkmOxNY65+q/MUnZVMwRp+KDm9C2HEsQMy8UqiIOy6G7iGwFbpipOR5vnHqxtJoh+G3rPtlDKt1AmeCshxr83Fgy/aIDfZY66EpPREsxj7UoKZQhZ2zD8ey+nskvqeKKDJ4ryOWqXbnaUxn4DfMuQU3QtXet1sxBnbyv6/CTuGY/Qo1nHrothXs1nNfQ/GtXqM9NgT+fvl94iOjL/DhyEMAQgEd86ZQk97ZSGUPWtZ9zUQTSgbqZarm36PUyl16OF+l1vCNvsR921eTlv/hcNH2A/BB4sjmGC7AKLFvImtXox36w85qz1URtGSeoux26ZJAJ8rOBY3V4wIClpYXggMmJe4zSAkBAHmBFc7nY33NOsqpJKgdPdeNm/RCVv8TXvfGKoYUdIroVDX7Q91B7hBtWBxRvsSECKRLMSktBvXOzl9F8x2ewVS/mvWZpGBw91Suw2iNMjiJOmrBvHKLtYY7lmBSdYChLuMe0="
  on:
    tags: true
    python: 3.6
