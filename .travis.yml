sudo: false
language: python
python:
  - "3.6"
cache:
  directories:
    - $HOME/.pip-cache/
install:
  - pip install --upgrade pip --cache-dir $HOME/.pip-cache/
  - pip install coveralls coverage --cache-dir $HOME/.pip-cache/
  - pip install -r requirements-dev.txt --cache-dir $HOME/.pip-cache/
  - pip install -e . --cache-dir $HOME/.pip-cache/
script:
  - flake8 molo
  - molo scaffold testapp --include molo.commenting ^commenting/
  - mkdir -p testapp/testapp/templates/core
  - cp molo/commenting/test_templates/article_page.html testapp/testapp/templates/core/article_page.html
  - cp molo/commenting/test_templates/main.html testapp/testapp/templates/core/main.html
  - flake8 testapp
  - cp test_settings.py testapp/testapp/settings/local.py
  - pip install -e testapp
  - py.test --cov=molo
after_success:
  - coveralls
before_deploy:
  - pip install twine
deploy:
  provider: pypi
  user: Praekelt
  password:
    secure: "lZ8oAKRWbHvcmVciD7mZgpGmXWhyPScCGzAaNObNigXU4qfOebjoWp5BMP5UNTnFB9LGt28MnraTRHmYd5tJxGD6jZrUGkXaFs3zrJoG1si+iN51+UUYb2a6MZoxIEN1McWQ0+nbJfbhFLS8wLCtHHkLBv8iGbFBr5n867nQl2stw8vsmfJBn+pQnGIQ5RKSJg3zaZWOxC/w4oyveKB5U49EnE3MYxNeKDMpIZj1cfWQzKfW/cuYZyMsGbQ8H3G3UF3G+fazryR5qzTw2+MyIDOcDfP4k+2a9UaTQSziNrS4uYiKR9owCV4Y51c+wNzLq//sl3JLEjhWRmF+VGFf+3nLxzP9zNQiGXH7v/rzPR6vRhj6nr47P2azNYRJFAlLuuOXa+MotUMgvF0QXs9Bgf9PTAt7BH4BH7+BQEPfhMS6kW6XD2ZoKlheYq+iNEA8LegEnCSIeueWX9pvFS85AX6DgHYud8/1mHeeAHM6AWgZ7Qpf49JAHF54gGAx6aQ9KfPQJDCoGjZPWvJPLNqLET535wj13Z8vlkEl0US0LWHkX7HtnFWLaLfqy8VH23RniCZkvPJclV5QALJv6Q+KCkDgHor7fM3YfE3phy/qWhnjpDzyqme6FPhApaYMSvL3TAcY+l/dqqLeOsPFvgcBMfvbVfzSCy8fqH+dcBrao2E="
  on:
    tags: true
    python: 3.6
